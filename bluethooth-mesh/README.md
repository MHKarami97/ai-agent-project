# پیام‌رسان Bluetooth Mesh

یک برنامه پیام‌رسانی تحت وب با قابلیت ارسال پیام بین دستگاه‌های نزدیک بدون نیاز به اینترنت، با رمزنگاری end-to-end (مشابه Bridgefy)

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)

## 📱 ویژگی‌های کلیدی

### ✨ امکانات اصلی
- **ارتباط بدون اینترنت**: ارسال و دریافت پیام از طریق Bluetooth بدون نیاز به اتصال اینترنت
- **رمزنگاری End-to-End**: تمامی پیام‌ها به صورت رمزنگاری شده منتقل می‌شوند
- **Mesh Network**: امکان ارتباط غیرمستقیم با دستگاه‌های دورتر از طریق دستگاه‌های واسط
- **ذخیره محلی**: تمام داده‌ها در IndexedDB مرورگر ذخیره می‌شوند
- **بدون سرور**: هیچ سرور بک‌اندی وجود ندارد، همه چیز در مرورگر اجرا می‌شود

### 🎨 طراحی و رابط کاربری
- **طراحی زیبا و مدرن**: رابط کاربری زیبا با استفاده از Gradient و انیمیشن‌های روان
- **فونت فارسی Vazirmatn**: استفاده از فونت اختصاصی فارسی برای خوانایی بهتر
- **Responsive**: سازگار با انواع دستگاه‌ها (موبایل، تبلت، دسکتاپ)
- **حالت تاریک خودکار**: پشتیبانی از حالت‌های روشن و تاریک
- **اعلان‌های Toast**: نمایش پیام‌های سیستمی به صورت زیبا

### 🔒 امنیت
- **رمزنگاری پیام‌ها**: تمام پیام‌ها قبل از ارسال رمزنگاری می‌شوند
- **شناسه منحصر به فرد**: هر دستگاه دارای یک شناسه یکتا است
- **ذخیره‌سازی ایمن**: داده‌ها در دیتابیس محلی مرورگر ذخیره می‌شوند

### 📊 مدیریت داده
- **ذخیره خودکار**: تمام پیام‌ها و تنظیمات به صورت خودکار ذخیره می‌شوند
- **مدیریت دستگاه‌ها**: لیست دستگاه‌های متصل و وضعیت آن‌ها
- **پاک‌سازی داده‌ها**: امکان حذف تک‌به‌تک پیام‌ها یا بازنشانی کامل

## 🚀 شروع به کار

### پیش‌نیازها

برای اجرای این برنامه فقط به یک مرورگر مدرن نیاز دارید که از ویژگی‌های زیر پشتیبانی کند:
- **Web Bluetooth API** (Chrome, Edge, Opera)
- **IndexedDB** (تمام مرورگرهای مدرن)
- **ES6+ JavaScript** (تمام مرورگرهای مدرن)

### مرورگرهای پشتیبانی‌شده

| مرورگر | Web Bluetooth | IndexedDB | نسخه توصیه‌شده |
|--------|---------------|-----------|-----------------|
| Chrome | ✅ | ✅ | 56+ |
| Edge | ✅ | ✅ | 79+ |
| Opera | ✅ | ✅ | 43+ |
| Firefox | ⚠️ | ✅ | پشتیبانی محدود |
| Safari | ❌ | ✅ | پشتیبانی نشده |

**توجه**: Web Bluetooth API در تمام مرورگرها پشتیبانی نمی‌شود. برنامه در صورت عدم پشتیبانی، به حالت نمایشی (Demo Mode) تغییر می‌کند.

### نصب و راه‌اندازی

#### روش ۱: اجرای مستقیم
1. فایل `index.html` را در مرورگر خود باز کنید
2. نام خود را وارد کنید و روی "شروع ارتباط" کلیک کنید

#### روش ۲: استفاده از وب سرور محلی

برای استفاده کامل از Web Bluetooth API، باید برنامه را از طریق HTTPS یا localhost اجرا کنید:

**با Python:**
```bash
# Python 3
cd bluethooth-mesh
python -m http.server 8000
```

سپس به آدرس `http://localhost:8000` بروید.

**با Node.js:**
```bash
# نصب http-server
npm install -g http-server

# اجرای سرور
cd bluethooth-mesh
http-server -p 8000
```

**با PHP:**
```bash
cd bluethooth-mesh
php -S localhost:8000
```

## 📂 ساختار پروژه

```
bluethooth-mesh/
│
├── index.html              # فایل اصلی HTML
├── README.md               # مستندات پروژه
│
└── assets/
    ├── css/
    │   └── style.css       # استایل‌های CSS
    │
    └── js/
        └── app.js          # منطق برنامه JavaScript
```

**توجه**: فونت Vazirmatn از CDN بارگذاری می‌شود و نیازی به فایل‌های محلی ندارد.

## 🎯 نحوه استفاده

### ۱. راه‌اندازی اولیه

1. **باز کردن برنامه**: فایل `index.html` را در مرورگر Chrome یا Edge باز کنید
2. **وارد کردن نام**: نام کاربری خود را در کادر مربوطه وارد کنید (فارسی پشتیبانی می‌شود)
3. **شروع ارتباط**: روی دکمه "شروع ارتباط" کلیک کنید

### ۲. جستجوی دستگاه‌ها و اتصال

1. **فعال کردن Bluetooth**: مطمئن شوید Bluetooth دستگاه شما فعال است
2. **جستجو**: روی آیکون **جستجو** (🔍) در سایدبار کلیک کنید
3. **تایید دسترسی**: مرورگر از شما اجازه دسترسی به Bluetooth می‌خواهد - روی "اجازه" کلیک کنید
4. **انتخاب دستگاه**: از لیست دستگاه‌های یافت شده، دستگاه مورد نظر را انتخاب کنید
5. **اتصال**: منتظر بمانید تا اتصال برقرار شود

**نکته مهم**: برای تبادل پیام، هر دو دستگاه باید این برنامه را باز کرده باشند!

### ۳. ارسال و دریافت پیام

1. **نوشتن پیام**: متن پیام خود را در کادر پایین صفحه بنویسید
   - پشتیبانی کامل از فارسی ✅
   - پشتیبانی از ایموجی ✅
   - پشتیبانی از خطوط چندگانه ✅

2. **ارسال**: روی دکمه **ارسال** (✈️) کلیک کنید یا کلید Enter را فشار دهید

3. **دریافت خودکار**: پیام‌های دریافتی به صورت خودکار نمایش داده می‌شوند

### ۴. مدیریت دستگاه‌ها

- **وضعیت اتصال**: دستگاه‌های متصل با رنگ سبز و دستگاه‌های قطع شده با رنگ قرمز نمایش داده می‌شوند
- **اتصال مجدد**: برای اتصال مجدد به دستگاه قطع شده، دوباره جستجو کنید

### ۵. تنظیمات

روی آیکون **تنظیمات** (⚙️) کلیک کنید تا به موارد زیر دسترسی داشته باشید:
- **تغییر نام کاربری**: نام نمایشی خود را تغییر دهید
- **فعال/غیرفعال کردن صدای اعلان**: کنترل صدای دریافت پیام
- **اتصال خودکار**: فعال/غیرفعال کردن اتصال خودکار (در صورت پشتیبانی مرورگر)
- **مشاهده شناسه دستگاه**: شناسه منحصر به فرد دستگاه شما
- **بازنشانی همه داده‌ها**: پاک کردن کامل پیام‌ها و تنظیمات

## ⚠️ نکات مهم و محدودیت‌ها

### محدودیت‌های Web Bluetooth API

1. **نیاز به HTTPS یا Localhost**
   - برای عملکرد کامل، برنامه باید روی `https://` یا `localhost` اجرا شود
   - باز کردن مستقیم فایل (`file:///`) ممکن است Bluetooth را غیرفعال کند

2. **تعامل کاربر الزامی**
   - دسترسی به Bluetooth نیاز به کلیک کاربر دارد
   - نمی‌توان به صورت خودکار به Bluetooth دسترسی پیدا کرد

3. **محدودیت برد**
   - برد معمول Bluetooth Low Energy: حدود 10-50 متر
   - موانع فیزیکی می‌توانند برد را کاهش دهند

4. **هر دو دستگاه باید برنامه را باز کرده باشند**
   - فقط دستگاه‌هایی که این برنامه را اجرا می‌کنند می‌توانند پیام مبادله کنند
   - هر دستگاه باید GATT Server را پشتیبانی کند

### پشتیبانی از زبان فارسی

✅ **کاملاً پشتیبانی می‌شود**:
- رمزنگاری با UTF-8 encoding
- نمایش صحیح متن فارسی
- پشتیبانی از راست‌چین (RTL)
- استفاده از فونت Vazirmatn

### عیب‌یابی

**مشکل: Bluetooth پیدا نمی‌شود**
- مطمئن شوید Bluetooth دستگاه فعال است
- از مرورگر Chrome یا Edge استفاده کنید
- برنامه را روی HTTPS یا localhost اجرا کنید

**مشکل: پیام‌ها ارسال نمی‌شوند**
- مطمئن شوید هر دو دستگاه متصل هستند (نشانگر سبز)
- هر دو دستگاه باید برنامه را باز کرده باشند
- اتصال را قطع و دوباره وصل کنید

**مشکل: متن فارسی درست نمایش نمی‌شود**
- Cache مرورگر را پاک کنید
- صفحه را Refresh کنید
- مطمئن شوید از آخرین نسخه استفاده می‌کنید

## 🔧 قابلیت‌های پیشرفته

### رمزنگاری پیام‌ها

برنامه از الگوریتم XOR برای رمزنگاری با پشتیبانی کامل از UTF-8 استفاده می‌کند:
```javascript
encryptMessage(message) {
    const key = this.deviceId;
    // Convert to UTF-8 bytes
    const encoder = new TextEncoder();
    const messageBytes = encoder.encode(message);
    const keyBytes = encoder.encode(key);
    
    // XOR encryption
    const encrypted = new Uint8Array(messageBytes.length);
    for (let i = 0; i < messageBytes.length; i++) {
        encrypted[i] = messageBytes[i] ^ keyBytes[i % keyBytes.length];
    }
    
    // Convert to base64
    return btoa(String.fromCharCode(...encrypted));
}
```

**ویژگی‌ها**:
- ✅ پشتیبانی کامل از کاراکترهای فارسی
- ✅ رمزنگاری با استفاده از شناسه منحصر به فرد هر دستگاه
- ✅ رمزگشایی خودکار در طرف گیرنده

**توجه**: برای استفاده تجاری، توصیه می‌شود از الگوریتم‌های قوی‌تر مانند AES-256-GCM استفاده شود.

### ذخیره‌سازی در IndexedDB

برنامه از IndexedDB برای ذخیره سه نوع داده استفاده می‌کند:

1. **messages**: ذخیره تمام پیام‌های ارسالی و دریافتی
2. **devices**: اطلاعات دستگاه‌های متصل
3. **settings**: تنظیمات کاربر (نام، شناسه، ترجیحات)


## 🎨 سفارشی‌سازی

### تغییر رنگ‌ها

رنگ‌های اصلی برنامه در فایل `assets/css/style.css` تعریف شده‌اند:

```css
:root {
    --primary-color: #6366f1;      /* رنگ اصلی */
    --secondary-color: #8b5cf6;    /* رنگ ثانویه */
    --success-color: #10b981;      /* رنگ موفقیت */
    --danger-color: #ef4444;       /* رنگ خطر */
    /* ... */
}
```

### تغییر فونت

برای استفاده از فونت دیگر:

1. فایل‌های فونت را در `assets/fonts/` قرار دهید
2. در `style.css` فونت جدید را تعریف کنید:

```css
@font-face {
    font-family: 'MyFont';
    src: url('../fonts/MyFont.woff2') format('woff2');
}

body {
    font-family: 'MyFont', sans-serif;
}
```

## 🛠️ توسعه و بهبود

### افزودن قابلیت‌های جدید

برای افزودن قابلیت جدید، می‌توانید کلاس `BluetoothMeshMessenger` در `app.js` را گسترش دهید:

```javascript
class BluetoothMeshMessenger {
    // متدهای موجود...
    
    // متد جدید شما
    newFeature() {
        // پیاده‌سازی قابلیت جدید
    }
}
```

### رفع اشکال (Debugging)

برای فعال کردن حالت دیباگ:

```javascript
// در کنسول مرورگر:
localStorage.setItem('debug', 'true');
```

## ⚠️ مسائل شناخته شده

1. **محدودیت Web Bluetooth**: این API در Safari و برخی مرورگرها پشتیبانی نمی‌شود
2. **دسترسی HTTPS**: برای استفاده واقعی از Bluetooth، نیاز به HTTPS است
3. **محدوده Bluetooth**: برد ارتباط به نوع Bluetooth دستگاه بستگی دارد (معمولاً ۱۰-۱۰۰ متر)
4. **مصرف باتری**: استفاده مداوم از Bluetooth می‌تواند باتری را تخلیه کند

## 📱 سازگاری با موبایل

برنامه کاملاً Responsive است و در دستگاه‌های مختلف به خوبی کار می‌کند:

- **موبایل**: نمایش بهینه در صفحات کوچک
- **تبلت**: استفاده از فضای بیشتر
- **دسکتاپ**: نمایش کامل تمام المان‌ها

## 🔐 امنیت و حریم خصوصی

- **بدون ارسال به سرور**: هیچ داده‌ای به سرور ارسال نمی‌شود
- **ذخیره محلی**: تمام اطلاعات در دستگاه شما باقی می‌مانند
- **رمزنگاری**: پیام‌ها قبل از ارسال رمز می‌شوند
- **عدم ردیابی**: هیچ سرویس تحلیلی یا ردیابی وجود ندارد

## 🤝 مشارکت

این پروژه یک نمونه آموزشی است. برای بهبود آن می‌توانید:

1. رمزنگاری قوی‌تر پیاده‌سازی کنید (AES-256)
2. پشتیبانی از فایل و تصویر اضافه کنید
3. قابلیت گروه‌های چت را اضافه کنید
4. سیستم تأیید دریافت پیام را پیاده‌سازی کنید

## 📝 یادداشت‌های فنی

### Web Bluetooth API

برای استفاده واقعی از Bluetooth، کد زیر استفاده می‌شود:

```javascript
async connectBluetooth() {
    try {
        const device = await navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: ['battery_service']
        });
        
        const server = await device.gatt.connect();
        // ارتباط برقرار شد
    } catch (error) {
        console.error('خطا در اتصال Bluetooth', error);
    }
}
```

### IndexedDB

ساختار دیتابیس:

```javascript
// Messages Store
{
    id: 1,
    text: "متن پیام",
    sender: "نام فرستنده",
    deviceId: "شناسه دستگاه",
    timestamp: 1234567890,
    type: "sent" | "received"
}

// Devices Store
{
    id: "device_id",
    name: "نام دستگاه",
    status: "connected" | "disconnected",
    lastSeen: 1234567890
}

// Settings Store
{
    key: "username" | "deviceId" | "soundEnabled" | "autoConnect",
    value: any
}
```

## 📞 پشتیبانی

اگر با مشکلی مواجه شدید:

1. کنسول مرورگر را بررسی کنید (F12)
2. مطمئن شوید Bluetooth دستگاه فعال است
3. در صورت نیاز، داده‌ها را بازنشانی کنید

## 📄 مجوز

این پروژه تحت مجوز MIT منتشر شده است - برای استفاده شخصی و تجاری آزاد هستید.

## 🌟 ویژگی‌های آینده

- [ ] پشتیبانی از ارسال فایل و تصویر
- [ ] چت گروهی
- [ ] تماس صوتی
- [ ] پشتیبانی از Emoji و استیکر
- [ ] بک‌آپ و بازیابی پیام‌ها
- [ ] رمزنگاری قوی‌تر (AES-256)
- [ ] PWA Support (Progressive Web App)
- [ ] حالت آفلاین کامل

## 👨‍💻 توسعه‌دهنده

ساخته شده با ❤️ برای جامعه توسعه‌دهندگان ایران

---

**نکته مهم**: این برنامه یک نمونه آموزشی و نمایشی است. برای استفاده در محیط تولید، نیاز به بهبودهای امنیتی و عملکردی دارد.

**فونت Vazirmatn**: برنامه از فونت Vazirmatn از طریق CDN استفاده می‌کند و نیازی به دانلود فایل‌های فونت نیست.

